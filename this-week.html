<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marathon Training Plan - This Week</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="design-system-tokens.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <h1 class="page-heading font-heading-large">This week test</h1>

        <div id="current-week-container">
            <!-- Current week content will be rendered here -->
            <div class="week-header-banner">
                <h2 id="current-week-date" class="font-heading-medium">Current Week</h2>
                <span class="week-distance" id="current-week-distance"></span>
            </div>
        </div>

        <!-- Bottom Navigation Bar -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-item" id="home-link">
                <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="nav-label font-body-small">Home</span>
            </a>
            <a href="this-week.html" class="nav-item active" id="this-week-link">
                <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 4H5C3.89543 4 3 4.89543 3 6V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V6C21 4.89543 20.1046 4 19 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="nav-label font-body-small">This Week</span>
            </a>
            <a href="coming-up.html" class="nav-item" id="coming-up-link">
                <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 6H3.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 12H3.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3 18H3.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="nav-label font-body-small">Coming Up</span>
            </a>
        </nav>
    </div>

    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            renderFirstWeek(); 
            loadProgress();
            
            function renderFirstWeek() {
                const startDate = new Date('2025-06-02'); // Monday, June 2nd, 2025
                const currentWeekIndex = 0;
                const weekNum = currentWeekIndex + 1;
                const currentWeek = trainingPlan[currentWeekIndex];
                const weekId = `week${weekNum}`; // Changed to match the expected format
                
                // Calculate week dates starting from Monday
                const weekDates = generateDatesForWeek(startDate);
                
                // Update week header
                document.getElementById('current-week-date').textContent = 
                    `Week ${weekNum}: ${formatDate(startDate)}`;
                document.getElementById('current-week-distance').textContent = 
                    currentWeek.weekDistance;
                
                // Generate week content HTML
                let weekHTML = `
                    <div class="week-container" id="${weekId}-container">
                        <div class="week-content">
                            <div class="progress-container">
                                <div class="progress-bars">
                                    ${Array(7).fill().map((_, i) => `
                                        <div class="progress-segment" id="${weekId}-progress-${i}"></div>
                                    `).join('')}
                                </div>
                                <div class="progress-footer">
                                    <div class="workouts-count" id="${weekId}-workouts">
                                        <span class="label">Workouts:</span>
                                        <span class="value">0/7</span>
                                    </div>
                                    <div class="distance-count" id="${weekId}-distance">
                                        <span class="label">Distance:</span>
                                        <span class="value">0/${calculateWeekDistance(currentWeek.workouts)}km</span>
                                    </div>
                                </div>
                            </div>
                            <div class="days-container">
                `;

                // Generate day cards with onclick handler to navigate to detail page
                weekDates.forEach((date, dayIndex) => {
                    const workout = currentWeek.workouts[dayIndex];
                    const id = `week${weekNum}_day${dayIndex + 1}`;
                    
                    weekHTML += `
                        <div class="day-card ${workout.type}" onclick="navigateToWorkout(${weekNum}, ${dayIndex})">
                            <div class="card-header">
                                <div class="date-container">
                                    ${formatDate(date)}
                                </div>
                                <div class="checkbox-container" onclick="event.stopPropagation()">
                                    <input type="checkbox" id="${id}" onchange="toggleCompleted(this, ${weekNum})">
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="workout-title">${workout.title}</div>
                                <div class="workout-time">${workout.time}</div>
                            </div>
                        </div>
                    `;
                });

                weekHTML += `
                            </div>
                        </div>
                    </div>
                `;

                // Append week content after the header
                document.getElementById('current-week-container').innerHTML = weekHTML;
                
                // Update progress bar for first week
                updateProgressBar(weekNum);
            }
            
            // Helper function to generate dates for a week (Monday first)
            function generateDatesForWeek(startDate) {
                const dates = [];
                const currentDate = new Date(startDate);
                
                for (let i = 0; i < 7; i++) {
                    dates.push(new Date(currentDate));
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                return dates;
            }
        });
    </script>
</body>
</html>