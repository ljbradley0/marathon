<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marathon Training Plan - Home</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Marathon training plan </h1>

    <main>
        <div class="charts-container">
            <div class="chart-card">
                <h2>Total Progress</h2>
                <div class="circle-chart" id="progress-chart"></div>
            </div>
            
            <div class="chart-card">
                <h2>Workouts Completed</h2>
                <div class="bar-chart" id="workouts-chart"></div>
            </div>
            
            <div class="chart-card">
                <h2>Distance Completed</h2>
                <div class="bar-chart" id="distance-chart"></div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item active" id="home-link">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="nav-label">Home</span>
        </a>
        <a href="this-week.html" class="nav-item" id="this-week-link">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 4H5C3.89543 4 3 4.89543 3 6V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V6C21 4.89543 20.1046 4 19 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 14H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 14H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 14H16.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 18H8.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 18H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 18H16.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="nav-label">This Week</span>
        </a>
        <a href="coming-up.html" class="nav-item" id="coming-up-link">
            <svg class="nav-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3 6H3.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3 12H3.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3 18H3.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="nav-label">Coming Up</span>
        </a>
    </nav>

    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Render the progress circle chart
            function renderProgressChart() {
                const totalWeeks = trainingPlan.length;
                let completedWeeks = 0;
                
                // Calculate completed weeks
                for (let weekIndex = 0; weekIndex < totalWeeks; weekIndex++) {
                    const weekId = `week${weekIndex + 1}`;
                    const checkboxes = document.querySelectorAll(`#${weekId}-container input[type="checkbox"]`);
                    const totalWorkouts = trainingPlan[weekIndex].workouts.length;
                    const completedWorkouts = getCompletedWorkoutsCount(weekIndex);
                    
                    // Consider a week complete if all workouts are done
                    if (completedWorkouts === totalWorkouts) {
                        completedWeeks++;
                    }
                }
                
                // Calculate percentage
                const percentComplete = Math.round((completedWeeks / totalWeeks) * 100);
                
                // Generate SVG for circle chart
                const radius = 80;
                const strokeWidth = 12;
                const center = radius + strokeWidth;
                const circumference = 2 * Math.PI * radius;
                const strokeDashoffset = circumference - (percentComplete / 100) * circumference;
                
                const chartHTML = `
                    <div class="circle-chart-container">
                        <svg width="${center * 2}" height="${center * 2}" viewBox="0 0 ${center * 2} ${center * 2}">
                            <!-- Background circle -->
                            <circle 
                                cx="${center}" 
                                cy="${center}" 
                                r="${radius}"
                                fill="transparent"
                                stroke="#E5E5E5"
                                stroke-width="${strokeWidth}"
                            />
                            
                            <!-- Progress circle -->
                            <circle 
                                cx="${center}" 
                                cy="${center}" 
                                r="${radius}"
                                fill="transparent"
                                stroke="#72E4B0"
                                stroke-width="${strokeWidth}"
                                stroke-dasharray="${circumference}"
                                stroke-dashoffset="${strokeDashoffset}"
                                transform="rotate(-90 ${center} ${center})"
                                stroke-linecap="round"
                            />
                        </svg>
                        
                        <!-- Percentage text in the middle -->
                        <div class="circle-percent">
                            <span>${percentComplete}%</span>
                        </div>
                        <div class="circle-label">
                            <span>${completedWeeks}/${totalWeeks} weeks</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('progress-chart').innerHTML = chartHTML;
            }
            
            // Render workout completion bar chart
            function renderWorkoutsChart() {
                const totalWorkouts = trainingPlan.reduce((total, week) => 
                    total + week.workouts.length, 0);
                let completedWorkouts = 0;
                
                // Count completed workouts
                const savedProgress = JSON.parse(localStorage.getItem('marathonProgress') || '{}');
                Object.keys(savedProgress).forEach(id => {
                    if (savedProgress[id]) {
                        completedWorkouts++;
                    }
                });
                
                // Calculate percentage
                const percentage = Math.min(100, Math.round((completedWorkouts / totalWorkouts) * 100));
                
                // Generate HTML for bar chart
                const chartHTML = `
                    <div class="bar-chart-container">
                        <div class="bar-chart-header">
                            <span>${completedWorkouts}/${totalWorkouts} workouts</span>
                        </div>
                        <div class="bar-chart-bar">
                            <div class="bar-chart-progress" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
                
                document.getElementById('workouts-chart').innerHTML = chartHTML;
            }
            
            // Render distance completion bar chart
            function renderDistanceChart() {
                const totalDistance = trainingPlan.reduce((total, week) => 
                    total + calculateWeekDistance(week.workouts), 0);
                let completedDistance = 0;
                
                // Calculate completed distance
                const savedProgress = JSON.parse(localStorage.getItem('marathonProgress') || '{}');
                
                trainingPlan.forEach((week, weekIndex) => {
                    week.workouts.forEach((workout, dayIndex) => {
                        const id = `week${weekIndex + 1}_day${dayIndex + 1}`;
                        if (savedProgress[id]) {
                            completedDistance += workout.distance;
                        }
                    });
                });
                
                // Calculate percentage
                const percentage = Math.min(100, Math.round((completedDistance / totalDistance) * 100));
                
                // Generate HTML for bar chart
                const chartHTML = `
                    <div class="bar-chart-container">
                        <div class="bar-chart-header">
                            <span>${completedDistance}/${totalDistance} km</span>
                        </div>
                        <div class="bar-chart-bar">
                            <div class="bar-chart-progress" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
                
                document.getElementById('distance-chart').innerHTML = chartHTML;
            }
            
            // Helper function to count completed workouts for a week
            function getCompletedWorkoutsCount(weekIndex) {
                const savedProgress = JSON.parse(localStorage.getItem('marathonProgress') || '{}');
                let count = 0;
                
                for (let dayIndex = 0; dayIndex < trainingPlan[weekIndex].workouts.length; dayIndex++) {
                    const id = `week${weekIndex + 1}_day${dayIndex + 1}`;
                    if (savedProgress[id]) {
                        count++;
                    }
                }
                
                return count;
            }
            
            // Render all charts
            renderProgressChart();
            renderWorkoutsChart();
            renderDistanceChart();
            
            // Add active class to current page navigation item
            const currentPage = window.location.pathname.split('/').pop();
            if (currentPage === 'index.html' || currentPage === '') {
                document.getElementById('home-link').classList.add('active');
            } else if (currentPage === 'this-week.html') {
                document.getElementById('this-week-link').classList.add('active');
            } else if (currentPage === 'coming-up.html') {
                document.getElementById('coming-up-link').classList.add('active');
            }
        });
    </script>
</body>
</html>